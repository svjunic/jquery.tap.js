/*
 * Last Change: Tue Nov 04 2014 11:10:05 GMT+0900 (JST)
 * @project jquery.tap.js
 * @fileOverview 限定的な領域に対してtap（またはカスタムイベント）を発火する機能を提供します。
 * @version 1.0.1
 * @author sv.junic@gmail.com
 * @url https://github.com/svjunic/jquery.tap.js
*/
!function(a,b,c){"use strict";function d(a,b){var c,d;return d=a.data(m.EVENT_NAME),"undefined"==typeof d?(c=[],c.push(b),a.on("touchstart touchmove touchend",f),a.on("click",i)):(c=a.data(m.EVENT_NAME).split(","),c.push(b)),d=c.join(","),a.data(m.EVENT_NAME,d),a}function e(a,b){var c=a.data(m.EVENT_NAME),d=c.split(","),e=d.indexOf(b);if(-1===e)throw"This event has not been registered.";return d.splice(e,1),0===d.length?(a.removeData(m.EVENT_NAME),a.removeData(m.IS_TOUCHED),a.removeData(m.IS_TOUCH_MOVED),a.removeData(m.TIMESTAMP),a.off("touchstart touchmove touchend",f),a.off("click",i)):a.data(m.EVENT_NAME,d.join(",")),a}function f(a){var b=c(a.target),d=c(a.currentTarget);if(k&&console.log(a.type,b),l.on("click",{$target:b},h),"touchstart"===a.type)return d.data(m.IS_TOUCHED,!0),d.data(m.IS_TOUCH_MOVED,!1),d.data(m.TIMESTAMP,a.timeStamp),void l.off("click",h);if("touchmove"===a.type)return d.data(m.IS_TOUCH_MOVED,!0),void l.off("click",h);if("touchend"===a.type){if(d.data(m.IS_TOUCH_MOVED))return k&&console.log("touch moved"),void l.off("click",h);if(a.timeStamp-d.data(m.TIMESTAMP)>p)return k&&console.log("long tap"),void l.off("click",h);k&&console.log("touchend listener",d.data(m.EVENT_NAME),b),j(b,d.data(m.EVENT_NAME)),l.off("click",h),g(b)}}function g(a){l.one("click",{$target:a},h),k&&console.log("on click throuth. 300ms."),clearTimeout(n),n=setTimeout(function(){k&&console.log("off click throuth. 300ms."),l.off("click",h)},350)}function h(a){a.preventDefault(),a.stopPropagation()}function i(a){var b=c(a.target),d=c(a.currentTarget);d.data(m.IS_TOUCHED)||(k&&console.log("click listener",d.data(m.EVENT_NAME),b),j(b,d.data(m.EVENT_NAME)))}function j(a,b){for(var c=b.split(","),d=0,e=c.length;e>d;d++)a.trigger(c[d]),r.test(c[d])||k&&console.log(c[d])}var k=!1,l=c(b),m={};m.EVENT_NAME="eventName",m.IS_TOUCHED="isToudched",m.IS_TOUCH_MOVED="isToudchMoved",m.TIMESTAMP="touchstartTimestamp";var n,o="tap",p=500,q=/^(blur|focus|change|select|selectstart|submit|reset|abort|error|load|unload|click|dblclick|keyup|keydown|keypress|mouseout|mouseover|mouseup|mousedown|mousemove|dragdrop|touchstart|touchmove|touchend)/,r=/^[a-zZ-Z0-9]*\.[a-zZ-Z0-9]*$/;c.fn.listenTap=function(a){var b;if("string"!=typeof a)b=o;else{if(""===a)throw"[ jquery.tap ] Invalid eventName.";if(q.test(a))throw"[ jquery.tap ] Invalid eventName.";b=a}var e,f,g=c(this);f=g.data(m.EVENT_NAME);try{if("string"==typeof f&&(e=f.split(","),-1!==e.indexOf(b)))throw"The event has already been registered.";d(g,b)}catch(h){k&&console.error(h)}return g},c.fn.listenTapDestroy=function(a){var b=a||o,d=c(this);try{e(d,b)}catch(f){k&&console.error(f)}return d}}(window,document,jQuery);